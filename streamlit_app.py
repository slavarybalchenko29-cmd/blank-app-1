import streamlit as st
import google.generativeai as genai
from PyPDF2 import PdfReader

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
st.set_page_config(page_title="AI –¢–µ–Ω–¥–µ—Ä–Ω–∏–π –ê–Ω–∞–ª—ñ—Ç–∏–∫", page_icon="‚öñÔ∏è")

# –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞ –æ–ø–∏—Å
st.title("üèõÔ∏è AI –¢–µ–Ω–¥–µ—Ä–Ω–∏–π –ê–Ω–∞–ª—ñ—Ç–∏–∫ (Prozorro)")
st.write("–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ç–µ–Ω–¥–µ—Ä–Ω—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é (PDF), —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–∏–∑–∏–∫–∏ —Ç–∞ –ø—ñ–¥—ñ–±—Ä–∞—Ç–∏ –Ω–æ—É—Ç–±—É–∫–∏.")

# –°–∞–π–¥–±–∞—Ä –¥–ª—è –∫–ª—é—á–∞
with st.sidebar:
    st.header("–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è")
    api_key = st.text_input("–í–≤–µ–¥—ñ—Ç—å Google Gemini API Key", type="password")
    st.markdown("[–û—Ç—Ä–∏–º–∞—Ç–∏ –∫–ª—é—á –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ](https://aistudio.google.com/app/apikey)")

# –û—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞
if api_key:
    genai.configure(api_key=api_key)
    
    uploaded_file = st.file_uploader("–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –¢–ó (PDF)", type=["pdf"])
    
    if uploaded_file is not None:
        # –ß–∏—Ç–∞–Ω–Ω—è PDF
        reader = PdfReader(uploaded_file)
        text = ""
        for page in reader.pages:
            text += page.extract_text()
            
        st.info(f"–î–æ–∫—É–º–µ–Ω—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ! –ó–Ω–∞–π–¥–µ–Ω–æ {len(reader.pages)} —Å—Ç–æ—Ä—ñ–Ω–æ–∫.")
        
        # –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫—É –∞–Ω–∞–ª—ñ–∑—É
        if st.button("üîç –ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –¢–µ–Ω–¥–µ—Ä"):
            with st.spinner("AI –∞–Ω–∞–ª—ñ–∑—É—î —é—Ä–∏–¥–∏—á–Ω—ñ —Ä–∏–∑–∏–∫–∏ —Ç–∞ —Ç–µ—Ö–Ω—ñ—á–Ω—ñ –≤–∏–º–æ–≥–∏..."):
                try:
                    # –í–∏–±—ñ—Ä –º–æ–¥–µ–ª—ñ (–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –≤–µ—Ä—Å—ñ—è)
                    model = genai.GenerativeModel('gemini-1.5-flash')
                    
                    # –ü—Ä–æ–º–ø—Ç (–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –¥–ª—è AI)
                    prompt = f"""
                    –¢–∏ - –µ–∫—Å–ø–µ—Ä—Ç –∑ –ø—É–±–ª—ñ—á–Ω–∏—Ö –∑–∞–∫—É–ø—ñ–≤–µ–ª—å –≤ –£–∫—Ä–∞—ó–Ω—ñ. –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π —Ü–µ–π —Ç–µ–∫—Å—Ç —Ç–µ–Ω–¥–µ—Ä–Ω–æ—ó –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó –Ω–∞ –∑–∞–∫—É–ø—ñ–≤–ª—é –Ω–æ—É—Ç–±—É–∫—ñ–≤.
                    
                    –¢–≤–æ—î –∑–∞–≤–¥–∞–Ω–Ω—è:
                    1. –í–∏—Ç—è–≥–Ω–∏ –¢–ï–•–ù–Ü–ß–ù–Ü –í–ò–ú–û–ì–ò –¥–æ –Ω–æ—É—Ç–±—É–∫–∞ (–ü—Ä–æ—Ü–µ—Å–æ—Ä, RAM, –ü–∞–º'—è—Ç—å, –ï–∫—Ä–∞–Ω).
                    2. –ü–æ—Ä—ñ–≤–Ω—è–π —ó—Ö –∑ –º–æ—ó–º —Ç–æ–≤–∞—Ä–æ–º: "Latitude Pro 4200" (Intel Core i7 14 —è–¥–µ—Ä, 16GB RAM, 512GB SSD). –ù–∞–ø–∏—à–∏, —á–∏ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –≤—ñ–Ω.
                    3. –ó–Ω–∞–π–¥–∏ –†–ò–ó–ò–ö–ò (–¥–∏—Å–∫—Ä–∏–º—ñ–Ω–∞—Ü—ñ–π–Ω—ñ –≤–∏–º–æ–≥–∏, —à—Ç—Ä–∞—Ñ–∏, —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –¥–æ–≤—ñ–¥–∫–∏).
                    4. –î–∞–π –≤–∏—Å–Ω–æ–≤–æ–∫: –ß–∏ –≤–∞—Ä—Ç–æ –±—Ä–∞—Ç–∏ —É—á–∞—Å—Ç—å?
                    
                    –¢–µ–∫—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞:
                    {text[:30000]} 
                    """
                    # –û–±—Ä—ñ–∑–∞—î–º–æ —Ç–µ–∫—Å—Ç, —â–æ–± –≤–ª—ñ–∑–ª–æ —É –ª—ñ–º—ñ—Ç–∏, —Ö–æ—á–∞ Gemini 1.5 –ø—Ä–∏–π–º–∞—î –±–∞–≥–∞—Ç–æ
                    
                    response = model.generate_content(prompt)
                    
                    st.success("–ê–Ω–∞–ª—ñ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")
                    st.markdown(response.text)
                    
                except Exception as e:
                    st.error(f"–ü–æ–º–∏–ª–∫–∞: {e}")
else:
    st.warning("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å API –∫–ª—é—á –¥–ª—è –ø–æ—á–∞—Ç–∫—É —Ä–æ–±–æ—Ç–∏.")
